<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Johnson Family Mystery - Escape Room</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Text', serif;
            background: #0a0a0a;
            color: #e8dcc4;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Intro Screen */
        .intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .intro-screen.hidden {
            display: none;
        }

        .intro-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(2rem, 5vw, 4rem);
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            margin-bottom: 30px;
            text-align: center;
        }

        .intro-content {
            max-width: 800px;
            background: rgba(0, 0, 0, 0.7);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.2);
        }

        .detective-badge {
            width: 120px;
            height: 120px;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 60px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .intro-text {
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 20px;
            text-align: center;
        }

        .start-btn {
            display: block;
            margin: 30px auto 0;
            padding: 15px 50px;
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            color: #1a1a2e;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.7);
        }

        /* Top Bar */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.8) 100%);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 2px solid #ffd700;
            flex-wrap: wrap;
            gap: 10px;
        }

        .room-name {
            font-family: 'Cinzel', serif;
            font-size: clamp(1rem, 2.5vw, 1.5rem);
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer {
            font-family: 'Cinzel', serif;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            color: #ff4444;
            text-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
        }

        .timer.warning {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            color: #e8dcc4;
        }

        .stat-icon {
            font-size: 1.3rem;
        }

        /* Game Container */
        .game-container {
            display: none;
            min-height: 100vh;
            padding-top: 80px;
            padding-bottom: 200px;
        }

        .game-container.active {
            display: block;
        }

        /* Room */
        .room {
            display: none;
            position: relative;
            min-height: calc(100vh - 280px);
        }

        .room.active {
            display: block;
        }

        .room-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: brightness(0.4) saturate(0.8);
            z-index: -1;
        }

        .room-background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, transparent 0%, rgba(0, 0, 0, 0.7) 100%);
        }

        /* Room Content */
        .room-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .room-intro {
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.2);
        }

        .room-intro h2 {
            font-family: 'Cinzel', serif;
            color: #ffd700;
            font-size: clamp(1.5rem, 3vw, 2rem);
            margin-bottom: 20px;
            text-align: center;
        }

        .room-intro p {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        /* Clickable Objects */
        .objects-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .clickable-object {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #8b7355;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .clickable-object:hover {
            border-color: #ffd700;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .clickable-object.examined {
            border-color: #4caf50;
        }

        .clickable-object.examined::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4caf50;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
        }

        .object-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .object-name {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: #ffd700;
        }

        /* Questions Section */
        .questions-section {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .questions-section h3 {
            font-family: 'Cinzel', serif;
            color: #ffd700;
            font-size: 1.5rem;
            margin-bottom: 25px;
            text-align: center;
        }

        .question-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #555;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .question-item.correct {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }

        .question-item.incorrect {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        .question-text {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #ffd700;
        }

        .question-input {
            width: 100%;
            padding: 12px 15px;
            font-family: 'Crimson Text', serif;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #555;
            border-radius: 8px;
            color: #e8dcc4;
            transition: all 0.3s ease;
        }

        .question-input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .question-input:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .feedback {
            margin-top: 10px;
            font-size: 0.95rem;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.success {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .feedback.error {
            background: rgba(255, 68, 68, 0.2);
            color: #ff6b6b;
        }

        /* Code Entry */
        .code-section {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.95), rgba(30, 30, 30, 0.95));
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
        }

        .code-section h3 {
            font-family: 'Cinzel', serif;
            color: #ffd700;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .code-hint {
            color: #aaa;
            margin-bottom: 25px;
            font-style: italic;
        }

        .code-display {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .code-digit {
            width: 60px;
            height: 70px;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #ffd700;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: #ffd700;
            transition: all 0.3s ease;
        }

        .code-digit.filled {
            background: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .code-digit.correct {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4caf50;
            color: #4caf50;
        }

        .unlock-btn {
            padding: 15px 40px;
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            color: #1a1a2e;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .unlock-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.7);
        }

        .unlock-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 500;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(145deg, #1a1a2e, #2a2a3e);
            border: 2px solid #ffd700;
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #ffd700;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .modal-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Cinzel', serif;
            color: #ffd700;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .modal-text {
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .clue-card {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
            border: 1px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .clue-card h4 {
            color: #ffd700;
            margin-bottom: 10px;
            font-family: 'Cinzel', serif;
        }

        .collect-clue-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            background: linear-gradient(145deg, #4caf50, #388e3c);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .collect-clue-btn:hover {
            transform: scale(1.02);
        }

        .collect-clue-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Character Profiles */
        .characters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .character-card {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #8b7355;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .character-card:hover {
            border-color: #ffd700;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .character-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .character-info {
            padding: 15px;
        }

        .character-name {
            font-family: 'Cinzel', serif;
            color: #ffd700;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .character-role {
            color: #aaa;
            font-style: italic;
        }

        /* Story Narration Box */
        .narration-box {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0.98) 0%, rgba(0, 0, 0, 0.9) 100%);
            border-top: 2px solid #ffd700;
            padding: 20px;
            z-index: 90;
        }

        .narration-content {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }

        .narrator-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid #ffd700;
            object-fit: cover;
            flex-shrink: 0;
        }

        .narration-text {
            flex: 1;
        }

        .narrator-name {
            font-family: 'Cinzel', serif;
            color: #ffd700;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .narration-message {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #e8dcc4;
        }

        .narration-continue {
            color: #ffd700;
            font-size: 0.9rem;
            margin-top: 10px;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Inventory Panel */
        .inventory-panel {
            display: none;
            position: fixed;
            top: 80px;
            right: 20px;
            width: 300px;
            max-height: 60vh;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            z-index: 200;
            overflow-y: auto;
        }

        .inventory-panel.active {
            display: block;
        }

        .inventory-title {
            font-family: 'Cinzel', serif;
            color: #ffd700;
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .inventory-item {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid #555;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .inventory-toggle {
            background: none;
            border: 2px solid #ffd700;
            color: #ffd700;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            transition: all 0.3s ease;
        }

        .inventory-toggle:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        /* Hint Button */
        .hint-btn {
            background: linear-gradient(145deg, #9c27b0, #7b1fa2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .hint-btn:hover {
            transform: scale(1.05);
        }

        .hint-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Hint Modal */
        .hint-display {
            background: rgba(156, 39, 176, 0.2);
            border: 1px solid #9c27b0;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .hint-display.show {
            display: block;
        }

        /* Fill in the Blank */
        .fill-blank-section {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .fill-blank-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #555;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .fill-blank-item.correct {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }

        .fill-blank-sentence {
            font-size: 1.2rem;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
        }

        .blank-input {
            width: 100px;
            padding: 8px 12px;
            font-family: 'Crimson Text', serif;
            font-size: 1rem;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #ffd700;
            border-radius: 5px;
            color: #ffd700;
            text-align: center;
        }

        .blank-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .blank-input.correct {
            background: rgba(76, 175, 80, 0.2);
            border-color: #4caf50;
            color: #4caf50;
        }

        .blank-input.incorrect {
            background: rgba(255, 68, 68, 0.2);
            border-color: #ff4444;
            color: #ff4444;
        }

        /* Victory Screen */
        .victory-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3d0f 100%);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .victory-screen.active {
            display: flex;
        }

        .victory-content {
            text-align: center;
            max-width: 800px;
        }

        .victory-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(2rem, 5vw, 4rem);
            color: #4caf50;
            text-shadow: 0 0 30px rgba(76, 175, 80, 0.5);
            margin-bottom: 30px;
        }

        .victory-badge {
            font-size: 100px;
            margin-bottom: 30px;
        }

        .victory-text {
            font-size: 1.3rem;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .family-reunion {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .family-member {
            text-align: center;
        }

        .family-member img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid #4caf50;
            object-fit: cover;
            margin-bottom: 10px;
        }

        .family-member p {
            color: #ffd700;
            font-family: 'Cinzel', serif;
        }

        .play-again-btn {
            padding: 15px 50px;
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            background: linear-gradient(145deg, #4caf50, #388e3c);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .play-again-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(76, 175, 80, 0.7);
        }

        /* Game Over Screen */
        .gameover-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2e1a1a 0%, #3e1616 50%, #230f0f 100%);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .gameover-screen.active {
            display: flex;
        }

        .gameover-content {
            text-align: center;
            max-width: 600px;
        }

        .gameover-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(2rem, 5vw, 4rem);
            color: #ff4444;
            text-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
            margin-bottom: 30px;
        }

        .gameover-icon {
            font-size: 100px;
            margin-bottom: 30px;
        }

        .gameover-text {
            font-size: 1.3rem;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .retry-btn {
            padding: 15px 50px;
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            background: linear-gradient(145deg, #ff4444, #cc0000);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .retry-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 68, 68, 0.7);
        }

        /* Reading Comprehension */
        .reading-section {
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #8b7355;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .reading-section h3 {
            font-family: 'Cinzel', serif;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .reading-text {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            font-size: 1.1rem;
            line-height: 2;
            margin-bottom: 20px;
            border-left: 4px solid #ffd700;
        }

        /* Progress Bar */
        .progress-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 4px;
            background: #333;
            transform: translateY(-50%);
            z-index: 0;
        }

        .progress-step {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #333;
            border: 3px solid #555;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: #888;
            z-index: 1;
            transition: all 0.3s ease;
        }

        .progress-step.active {
            background: linear-gradient(145deg, #ffd700, #b8860b);
            border-color: #ffd700;
            color: #1a1a2e;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .progress-step.completed {
            background: linear-gradient(145deg, #4caf50, #388e3c);
            border-color: #4caf50;
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .top-bar {
                flex-direction: column;
                padding: 10px;
            }

            .stats {
                width: 100%;
                justify-content: center;
            }

            .narration-content {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .inventory-panel {
                right: 10px;
                left: 10px;
                width: auto;
            }

            .modal-content {
                padding: 20px;
            }

            .code-digit {
                width: 50px;
                height: 60px;
                font-size: 1.5rem;
            }

            .fill-blank-sentence {
                font-size: 1rem;
            }

            .blank-input {
                width: 80px;
                padding: 6px 8px;
                font-size: 0.9rem;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake {
            animation: shake 0.5s ease;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.7); }
        }

        .glow {
            animation: glow 2s infinite;
        }

        /* Door unlock animation */
        @keyframes doorOpen {
            0% { transform: perspective(1000px) rotateY(0); }
            100% { transform: perspective(1000px) rotateY(-90deg); }
        }

        .door-opening {
            animation: doorOpen 1s ease forwards;
        }

        /* Transition Screen */
        .transition-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 600;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .transition-screen.active {
            display: flex;
        }

        .transition-icon {
            font-size: 100px;
            margin-bottom: 30px;
            animation: pulse 1s infinite;
        }

        .transition-text {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: #ffd700;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Intro Screen -->
    <div class="intro-screen" id="introScreen">
        <h1 class="intro-title">üîç The Johnson Family Mystery</h1>
        <div class="intro-content">
            <div class="detective-badge">üïµÔ∏è</div>
            <p class="intro-text">
                <strong>Welcome, Detective!</strong>
            </p>
            <p class="intro-text">
                Detective Sam receives a strange message: <em>the Johnson family has vanished from their home.</em> 
                Their house is locked. The only way to find them is to learn everything about them ‚Äî 
                who they are, where they are from, and what they love.
            </p>
            <p class="intro-text">
                <strong>Can you solve the mystery?</strong>
            </p>
            <p class="intro-text" style="font-size: 1rem; color: #aaa;">
                üè† Explore 3 locked rooms<br>
                üîê Find clues and answer questions<br>
                ‚è±Ô∏è You have 40 minutes<br>
                üí° Use hints wisely (3 per room)
            </p>
            <button class="start-btn" onclick="startGame()">Begin Investigation</button>
        </div>
    </div>

    <!-- Top Bar -->
    <div class="top-bar" id="topBar" style="display: none;">
        <div class="room-name" id="roomName">
            <span>üõãÔ∏è</span>
            <span id="roomTitle">Room 1 - The Living Room</span>
        </div>
        <div class="timer" id="timer">40:00</div>
        <div class="stats">
            <button class="hint-btn" id="hintBtn" onclick="useHint()">
                <span>üí°</span>
                <span>Hints: <span id="hintsLeft">3</span></span>
            </button>
            <button class="inventory-toggle" onclick="toggleInventory()">
                üìã Clues: <span id="clueCount">0</span>
            </button>
        </div>
    </div>

    <!-- Inventory Panel -->
    <div class="inventory-panel" id="inventoryPanel">
        <h3 class="inventory-title">üìã Collected Clues</h3>
        <div id="inventoryItems">
            <p style="color: #888; text-align: center;">No clues collected yet.</p>
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container" id="gameContainer">
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-step active" id="step1">1</div>
                <div class="progress-step" id="step2">2</div>
                <div class="progress-step" id="step3">3</div>
            </div>
        </div>

        <!-- Room 1 - Living Room -->
        <div class="room active" id="room1">
            <div class="room-background" style="background-image: url('https://images.unsplash.com/photo-1585412727339-54e4bae3bbf9?w=1200');"></div>
            
            <div class="room-content">
                <div class="room-intro fade-in">
                    <h2>üõãÔ∏è The Living Room</h2>
                    <p>You enter the Johnson family home. The living room is quiet and dark. Dust covers the furniture. On the table, you see some objects that might help you understand who lives here.</p>
                    <p><strong>Detective Sam thinks:</strong> "I need to find clues about this family. Who are they? What are their names? How old are they? Let me examine everything carefully."</p>
                </div>

                <!-- Reading Comprehension Section -->
                <div class="reading-section fade-in">
                    <h3>üìñ Read the Letter on the Table</h3>
                    <div class="reading-text">
                        <p>Dear Friends,</p>
                        <p>We are the Johnson family. We live in this beautiful house. The father's name <strong>is</strong> Tom. He <strong>is</strong> from London. He <strong>is</strong> forty-five years old. He <strong>is</strong> tall and <strong>has got</strong> blue eyes and blond hair. Tom <strong>has got</strong> a favourite colour. It <strong>is</strong> blue, like the sky!</p>
                        <p>The mother <strong>is</strong> Mary. She <strong>is not</strong> from England. She <strong>is</strong> from a beautiful city in France. She <strong>is</strong> forty-two years old. She <strong>is</strong> short and slim. She <strong>has got</strong> black hair and brown eyes.</p>
                        <p>We <strong>have got</strong> two children. They <strong>are</strong> Leo and Emma. They <strong>are</strong> happy children. Leo <strong>is</strong> a student. Emma <strong>is</strong> younger than Leo.</p>
                        <p>We <strong>are</strong> a happy family!</p>
                    </div>
                </div>

                <!-- Clickable Objects -->
                <div class="objects-container">
                    <div class="clickable-object" onclick="examineObject('familyPhoto')">
                        <div class="object-icon">üñºÔ∏è</div>
                        <div class="object-name">Family Photo</div>
                    </div>
                    <div class="clickable-object" onclick="examineObject('letter')">
                        <div class="object-icon">‚úâÔ∏è</div>
                        <div class="object-name">Old Letter</div>
                    </div>
                    <div class="clickable-object" onclick="examineObject('calendar')">
                        <div class="object-icon">üìÖ</div>
                        <div class="object-name">Calendar</div>
                    </div>
                    <div class="clickable-object" onclick="examineObject('newspaper')">
                        <div class="object-icon">üì∞</div>
                        <div class="object-name">Newspaper</div>
                    </div>
                </div>

                <!-- Characters -->
                <div class="room-intro">
                    <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ The Johnson Family</h2>
                    <p>Click on each family member to learn more about them:</p>
                </div>

                <div class="characters-grid">
                    <div class="character-card" onclick="showCharacter('tom')">
                        <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400" alt="Tom" class="character-image">
                        <div class="character-info">
                            <div class="character-name">Tom Johnson</div>
                            <div class="character-role">Father</div>
                        </div>
                    </div>
                    <div class="character-card" onclick="showCharacter('mary')">
                        <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400" alt="Mary" class="character-image">
                        <div class="character-info">
                            <div class="character-name">Mary Johnson</div>
                            <div class="character-role">Mother</div>
                        </div>
                    </div>
                    <div class="character-card" onclick="showCharacter('leo')">
                        <img src="https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?w=400" alt="Leo" class="character-image">
                        <div class="character-info">
                            <div class="character-name">Leo Johnson</div>
                            <div class="character-role">Son</div>
                        </div>
                    </div>
                    <div class="character-card" onclick="showCharacter('emma')">
                        <img src="https://images.unsplash.com/photo-1595702419689-6b626dc83c33?w=400" alt="Emma" class="character-image">
                        <div class="character-info">
                            <div class="character-name">Emma Johnson</div>
                            <div class="character-role">Daughter</div>
                        </div>
                    </div>
                </div>

                <!-- Questions Section -->
                <div class="questions-section">
                    <h3>üîì Answer the Questions to Get the Code</h3>
                    <p style="text-align: center; color: #aaa; margin-bottom: 20px;">Write complete sentences. Each correct answer gives you one digit of the code!</p>
                    
                    <div class="question-item" id="q1_1">
                        <div class="question-text">1. What is Tom's favourite colour? (Write a complete sentence)</div>
                        <input type="text" class="question-input" id="answer1_1" placeholder="His favourite colour is...">
                        <div class="feedback" id="feedback1_1"></div>
                    </div>

                    <div class="question-item" id="q1_2">
                        <div class="question-text">2. How old is Mary? (Write a complete sentence with "She")</div>
                        <input type="text" class="question-input" id="answer1_2" placeholder="She is...">
                        <div class="feedback" id="feedback1_2"></div>
                    </div>

                    <div class="question-item" id="q1_3">
                        <div class="question-text">3. Where is Mary from? (Write a complete sentence)</div>
                        <input type="text" class="question-input" id="answer1_3" placeholder="She is from...">
                        <div class="feedback" id="feedback1_3"></div>
                    </div>

                    <div class="question-item" id="q1_4">
                        <div class="question-text">4. What is the father's name? (Write a complete sentence)</div>
                        <input type="text" class="question-input" id="answer1_4" placeholder="The father's name is... / His name is...">
                        <div class="feedback" id="feedback1_4"></div>
                    </div>

                    <div class="question-item" id="q1_5">
                        <div class="question-text">5. Has Tom got blue eyes? (Write a complete sentence - Yes/No answer)</div>
                        <input type="text" class="question-input" id="answer1_5" placeholder="Yes, he has got... / No, he hasn't got...">
                        <div class="feedback" id="feedback1_5"></div>
                    </div>

                    <div class="question-item" id="q1_6">
                        <div class="question-text">6. Have the Johnsons got children? (Write a complete sentence)</div>
                        <input type="text" class="question-input" id="answer1_6" placeholder="Yes, they have got... / No, they haven't got...">
                        <div class="feedback" id="feedback1_6"></div>
                    </div>

                    <button class="unlock-btn" onclick="checkRoom1Answers()" style="margin-top: 20px; width: 100%;">Check My Answers</button>

                    <div class="hint-display" id="room1Hint"></div>
                </div>

                <!-- Code Section -->
                <div class="code-section">
                    <h3>üîê Enter the Door Code</h3>
                    <p class="code-hint">The code has 4 digits. Answer the questions correctly to discover them!</p>
                    <div class="code-display">
                        <div class="code-digit" id="digit1_1">?</div>
                        <div class="code-digit" id="digit1_2">?</div>
                        <div class="code-digit" id="digit1_3">?</div>
                        <div class="code-digit" id="digit1_4">?</div>
                    </div>
                    <button class="unlock-btn glow" id="unlockBtn1" onclick="unlockRoom(2)" disabled>üö™ Unlock the Door</button>
                </div>
            </div>
        </div>

        <!-- Room 2 - Bedrooms -->
        <div class="room" id="room2">
            <div class="room-background" style="background-image: url('https://images.unsplash.com/photo-1616594039964-ae9021a400a0?w=1200');"></div>
            
            <div class="room-content">
                <div class="room-intro fade-in">
                    <h2>üõèÔ∏è The Bedrooms</h2>
                    <p>You enter the bedrooms area. There are personal items everywhere. Each family member has their own space with special things. You can learn more about Leo and Emma here.</p>
                    <p><strong>Detective Sam thinks:</strong> "The children's rooms might have important clues. What do they like? What do they look like? I need to find more information!"</p>
                </div>

                <!-- Reading Section for Room 2 -->
                <div class="reading-section fade-in">
                    <h3>üìñ Leo's Diary (found on his desk)</h3>
                    <div class="reading-text">
                        <p>Dear Diary,</p>
                        <p>My name <strong>is</strong> Leo Johnson. I <strong>am</strong> sixteen years old. I <strong>am</strong> a student. I <strong>am</strong> tall and I <strong>have got</strong> green eyes and brown hair. I <strong>have got</strong> a big nose and a small mouth.</p>
                        <p>My favourite colour <strong>is</strong> green. My favourite animal <strong>is</strong> a turtle. Turtles <strong>are</strong> slow but they <strong>are</strong> very cool!</p>
                        <p>My sister Emma <strong>is</strong> twelve years old. She <strong>is not</strong> tall. She <strong>is</strong> short and slim. She <strong>has got</strong> blond hair and blue eyes. She <strong>has got</strong> a small nose and big eyes. Her favourite colour <strong>is</strong> pink. She <strong>has not got</strong> a turtle. She loves horses!</p>
                        <p>My mum's favourite colour <strong>is</strong> red. She <strong>has got</strong> a cat. The cat's name <strong>is</strong> Whiskers. My dad <strong>has got</strong> a dog.</p>
                    </div>
                </div>

                <!-- Clickable Objects -->
                <div class="objects-container">
                    <div class="clickable-object" onclick="examineObject('diary')">
                        <div class="object-icon">üìî</div>
                        <div class="object-name">Leo's Diary</div>
                    </div>
                    <div class="clickable-object" onclick="examineObject('petPhoto')">
                        <div class="object-icon">üêæ</div>
                        <div class="object-name">Pet Photos</div>
                    </div>
                    <div class="clickable-object" onclick="examineObject('notebook')">
                        <div class="object-icon">üìì</div>
                        <div class="object-name">School Notebook</div>
                    </div>
                    <div class="clickable-object" onclick="examineObject('poster')">
                        <div class="object-icon">üñºÔ∏è</div>
                        <div class="object-name">Room Posters</div>
                    </div>
                </div>

                <!-- Questions Section -->
                <div class="questions-section">
                    <h3>üîì Answer the Questions to Get the Code</h3>
                    
                    <div class="question-item" id="q2_1">
                        <div class="question-text">1. What is Leo's favourite animal? (Write a complete sentence)</div>
                        <input type="text" class="question-input" id="answer2_1" placeholder="His favourite animal is...">
                        <div class="feedback" id="feedback2_1"></div>
                    </div>

                    <div class="question-item" id="q2_2">
                        <div class="question-text">2. How old is Emma? (Write a complete sentence with "She")</div>
                        <input type="text" class="question-input" id="answer2_2" placeholder="She is...">
                        <div class="feedback" id="feedback2_2"></div>
                    </div>

                    <div class="question-item" id="q2_3">
                        <div class="question-text">3. What is Mary's favourite colour? (Write a complete sentence)</div>
                        <input type="text" class="question-input" id="answer2_3" placeholder="Her favourite colour is...">
                        <div class="feedback" id="feedback2_3"></div>
                    </div>

                    <div class="question-item" id="q2_4">
                        <div class="question-text">4. Who is Tom's daughter? (Write a complete sentence)</div>
                        <input type="text" class="question-input" id="answer2_4" placeholder="Tom's daughter is... / His daughter is...">
                        <div class="feedback" id="feedback2_4"></div>
                    </div>

                    <div class="question-item" id="q2_5">
                        <div class="question-text">5. Has Leo got brown hair? (Write a complete sentence)</div>
                        <input type="text" class="question-input" id="answer2_5" placeholder="Yes, he has got... / No, he hasn't got...">
                        <div class="feedback" id="feedback2_5"></div>
                    </div>

                    <div class="question-item" id="q2_6">
                        <div class="question-text">6. Is Emma tall or short? (Write a complete sentence)</div>
                        <input type="text" class="question-input" id="answer2_6" placeholder="She is...">
                        <div class="feedback" id="feedback2_6"></div>
                    </div>

                    <div class="question-item" id="q2_7">
                        <div class="question-text">7. What colour are Leo's eyes? (Write a complete sentence with "has got")</div>
                        <input type="text" class="question-input" id="answer2_7" placeholder="He has got...">
                        <div class="feedback" id="feedback2_7"></div>
                    </div>

                    <div class="question-item" id="q2_8">
                        <div class="question-text">8. Has Emma got a small nose or a big nose? (Write a complete sentence)</div>
                        <input type="text" class="question-input" id="answer2_8" placeholder="She has got...">
                        <div class="feedback" id="feedback2_8"></div>
                    </div>

                    <button class="unlock-btn" onclick="checkRoom2Answers()" style="margin-top: 20px; width: 100%;">Check My Answers</button>

                    <div class="hint-display" id="room2Hint"></div>
                </div>

                <!-- Code Section -->
                <div class="code-section">
                    <h3>üîê Enter the Door Code</h3>
                    <p class="code-hint">Find the 4-digit code by answering the questions!</p>
                    <div class="code-display">
                        <div class="code-digit" id="digit2_1">?</div>
                        <div class="code-digit" id="digit2_2">?</div>
                        <div class="code-digit" id="digit2_3">?</div>
                        <div class="code-digit" id="digit2_4">?</div>
                    </div>
                    <button class="unlock-btn glow" id="unlockBtn2" onclick="unlockRoom(3)" disabled>üö™ Unlock the Secret Room</button>
                </div>
            </div>
        </div>

        <!-- Room 3 - Secret Room -->
        <div class="room" id="room3">
            <div class="room-background" style="background-image: url('https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=1200');"></div>
            
            <div class="room-content">
                <div class="room-intro fade-in">
                    <h2>üîê The Secret Room</h2>
                    <p>You discovered a hidden room behind a bookshelf! This is where the Johnson family left their final message. To find them, you must prove you know everything about them.</p>
                    <p><strong>Detective Sam thinks:</strong> "This is the final challenge! I must complete all the sentences correctly to find the family. I need to use what I learned about them!"</p>
                </div>

                <!-- Final Summary -->
                <div class="reading-section fade-in">
                    <h3>üìñ The Final Message</h3>
                    <div class="reading-text">
                        <p>Dear Detective,</p>
                        <p>If you <strong>are</strong> reading this, you <strong>are</strong> very clever! We <strong>are</strong> the Johnson family. We <strong>are not</strong> lost. We <strong>are</strong> hiding!</p>
                        <p>To find us, you must prove you know us. Complete the sentences about our family. Use the verb TO BE (am, is, are), HAVE GOT and HAS GOT correctly.</p>
                        <p>Remember: Tom <strong>is</strong> the father. Mary <strong>is</strong> the mother. Leo and Emma <strong>are</strong> the children. We all <strong>have got</strong> different favourite things!</p>
                        <p><strong>Are</strong> you ready? <strong>Have</strong> you <strong>got</strong> all the clues? Let's begin!</p>
                    </div>
                </div>

                <!-- Fill in the Blanks Section -->
                <div class="fill-blank-section">
                    <h3 style="font-family: 'Cinzel', serif; color: #ffd700; margin-bottom: 25px; text-align: center;">‚úçÔ∏è Complete the Sentences</h3>
                    <p style="text-align: center; color: #aaa; margin-bottom: 30px;">Fill in the blanks with the correct words. Use: am, is, are, have got, has got, haven't got, hasn't got</p>

                    <!-- Affirmative Sentences -->
                    <h4 style="color: #4caf50; margin: 20px 0 15px;">‚úÖ Affirmative Sentences</h4>

                    <div class="fill-blank-item" id="fb1">
                        <div class="fill-blank-sentence">
                            <span>1. Tom</span>
                            <input type="text" class="blank-input" id="blank1" placeholder="...">
                            <span>45 years old.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb2">
                        <div class="fill-blank-sentence">
                            <span>2. Mary</span>
                            <input type="text" class="blank-input" id="blank2" placeholder="...">
                            <span>from Paris.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb3">
                        <div class="fill-blank-sentence">
                            <span>3. Leo and Emma</span>
                            <input type="text" class="blank-input" id="blank3" placeholder="...">
                            <span>Tom and Mary's children.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb4">
                        <div class="fill-blank-sentence">
                            <span>4. I</span>
                            <input type="text" class="blank-input" id="blank4" placeholder="...">
                            <span>Detective Sam.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb5">
                        <div class="fill-blank-sentence">
                            <span>5. Tom</span>
                            <input type="text" class="blank-input" id="blank5" placeholder="...">
                            <span>tall.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb6">
                        <div class="fill-blank-sentence">
                            <span>6. Emma's favourite animal</span>
                            <input type="text" class="blank-input" id="blank6" placeholder="...">
                            <span>a horse.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb7">
                        <div class="fill-blank-sentence">
                            <span>7. Leo</span>
                            <input type="text" class="blank-input" id="blank7" placeholder="...">
                            <span>green eyes.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb8">
                        <div class="fill-blank-sentence">
                            <span>8. Mary</span>
                            <input type="text" class="blank-input" id="blank8" placeholder="...">
                            <span>black hair.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb9">
                        <div class="fill-blank-sentence">
                            <span>9. We</span>
                            <input type="text" class="blank-input" id="blank9" placeholder="...">
                            <span>a happy family.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb10">
                        <div class="fill-blank-sentence">
                            <span>10. The Johnsons</span>
                            <input type="text" class="blank-input" id="blank10" placeholder="...">
                            <span>two children.</span>
                        </div>
                    </div>

                    <!-- Negative Sentences -->
                    <h4 style="color: #ff6b6b; margin: 30px 0 15px;">‚ùå Negative Sentences</h4>

                    <div class="fill-blank-item" id="fb11">
                        <div class="fill-blank-sentence">
                            <span>11. Mary</span>
                            <input type="text" class="blank-input" id="blank11" placeholder="..." style="width: 80px;">
                            <input type="text" class="blank-input" id="blank11b" placeholder="..." style="width: 80px;">
                            <span>from London. (She is from Paris)</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb12">
                        <div class="fill-blank-sentence">
                            <span>12. Emma</span>
                            <input type="text" class="blank-input" id="blank12" placeholder="..." style="width: 80px;">
                            <input type="text" class="blank-input" id="blank12b" placeholder="..." style="width: 80px;">
                            <span>tall. (She is short)</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb13">
                        <div class="fill-blank-sentence">
                            <span>13. Leo</span>
                            <input type="text" class="blank-input" id="blank13" placeholder="...">
                            <span>blue eyes. (He has got green eyes)</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb14">
                        <div class="fill-blank-sentence">
                            <span>14. The children</span>
                            <input type="text" class="blank-input" id="blank14" placeholder="..." style="width: 80px;">
                            <input type="text" class="blank-input" id="blank14b" placeholder="..." style="width: 80px;">
                            <span>adults. (They are children)</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb15">
                        <div class="fill-blank-sentence">
                            <span>15. Tom</span>
                            <input type="text" class="blank-input" id="blank15" placeholder="...">
                            <span>a cat. (He has got a dog)</span>
                        </div>
                    </div>

                    <!-- Interrogative Sentences -->
                    <h4 style="color: #ffd700; margin: 30px 0 15px;">‚ùì Interrogative Sentences</h4>

                    <div class="fill-blank-item" id="fb16">
                        <div class="fill-blank-sentence">
                            <span>16.</span>
                            <input type="text" class="blank-input" id="blank16" placeholder="...">
                            <span>Tom from London? Yes, he is.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb17">
                        <div class="fill-blank-sentence">
                            <span>17.</span>
                            <input type="text" class="blank-input" id="blank17" placeholder="...">
                            <span>Leo and Emma students? Yes, they are.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb18">
                        <div class="fill-blank-sentence">
                            <span>18.</span>
                            <input type="text" class="blank-input" id="blank18" placeholder="..." style="width: 80px;">
                            <span>Mary</span>
                            <input type="text" class="blank-input" id="blank18b" placeholder="..." style="width: 80px;">
                            <span>brown eyes? Yes, she has.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb19">
                        <div class="fill-blank-sentence">
                            <span>19.</span>
                            <input type="text" class="blank-input" id="blank19" placeholder="..." style="width: 80px;">
                            <span>the family</span>
                            <input type="text" class="blank-input" id="blank19b" placeholder="..." style="width: 80px;">
                            <span>a dog? Yes, they have.</span>
                        </div>
                    </div>

                    <div class="fill-blank-item" id="fb20">
                        <div class="fill-blank-sentence">
                            <span>20.</span>
                            <input type="text" class="blank-input" id="blank20" placeholder="...">
                            <span>you ready to find the family? Yes, I am!</span>
                        </div>
                    </div>

                    <button class="unlock-btn" onclick="checkRoom3Answers()" style="margin-top: 30px; width: 100%;">Check All Answers</button>

                    <div class="hint-display" id="room3Hint"></div>
                </div>

                <!-- Final Code Section -->
                <div class="code-section">
                    <h3>üîê The Final Code</h3>
                    <p class="code-hint">Complete all sentences correctly to unlock the mystery!</p>
                    <div class="code-display">
                        <div class="code-digit" id="digit3_1">?</div>
                        <div class="code-digit" id="digit3_2">?</div>
                        <div class="code-digit" id="digit3_3">?</div>
                        <div class="code-digit" id="digit3_4">?</div>
                    </div>
                    <button class="unlock-btn glow" id="unlockBtn3" onclick="winGame()" disabled>üéâ Find the Johnson Family!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Narration Box -->
    <div class="narration-box" id="narrationBox" style="display: none;">
        <div class="narration-content">
            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100" alt="Detective" class="narrator-avatar" id="narratorAvatar">
            <div class="narration-text">
                <div class="narrator-name" id="narratorName">Detective Sam</div>
                <div class="narration-message" id="narrationMessage">Welcome to the investigation!</div>
                <div class="narration-continue">Click anywhere to continue...</div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="objectModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <img src="" alt="Object" class="modal-image" id="modalImage">
            <h3 class="modal-title" id="modalTitle"></h3>
            <div class="modal-text" id="modalText"></div>
            <div class="clue-card" id="clueCard" style="display: none;">
                <h4>üìã New Clue Found!</h4>
                <p id="clueText"></p>
                <button class="collect-clue-btn" id="collectBtn" onclick="collectClue()">Add to Inventory</button>
            </div>
        </div>
    </div>

    <!-- Character Modal -->
    <div class="modal" id="characterModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeCharacterModal()">&times;</button>
            <img src="" alt="Character" class="modal-image" id="charModalImage" style="height: 250px;">
            <h3 class="modal-title" id="charModalName"></h3>
            <div class="modal-text" id="charModalText"></div>
        </div>
    </div>

    <!-- Transition Screen -->
    <div class="transition-screen" id="transitionScreen">
        <div class="transition-icon">üö™</div>
        <div class="transition-text" id="transitionText">Opening the door...</div>
    </div>

    <!-- Victory Screen -->
    <div class="victory-screen" id="victoryScreen">
        <div class="victory-content">
            <h1 class="victory-title">üéâ CONGRATULATIONS! üéâ</h1>
            <div class="victory-badge">üèÜ</div>
            <p class="victory-text">
                <strong>You found the Johnson family!</strong><br><br>
                They are safe! The family was hiding in their secret vacation house. They left clues because they wanted to find a clever detective to help them with a surprise party!
            </p>
            <div class="family-reunion">
                <div class="family-member">
                    <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100" alt="Tom">
                    <p>Tom</p>
                </div>
                <div class="family-member">
                    <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100" alt="Mary">
                    <p>Mary</p>
                </div>
                <div class="family-member">
                    <img src="https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?w=100" alt="Leo">
                    <p>Leo</p>
                </div>
                <div class="family-member">
                    <img src="https://images.unsplash.com/photo-1595702419689-6b626dc83c33?w=100" alt="Emma">
                    <p>Emma</p>
                </div>
            </div>
            <p class="victory-text" style="font-size: 1.1rem;">
                Tom says: "Thank you, Detective! You <strong>are</strong> amazing!"<br>
                Mary says: "We <strong>are</strong> so happy you found us!"<br>
                Leo says: "You <strong>have got</strong> great detective skills!"<br>
                Emma says: "This <strong>is</strong> the best day ever!"
            </p>
            <p id="finalTime" style="color: #4caf50; font-size: 1.2rem; margin-bottom: 20px;"></p>
            <button class="play-again-btn" onclick="location.reload()">Play Again</button>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div class="gameover-screen" id="gameoverScreen">
        <div class="gameover-content">
            <h1 class="gameover-title">‚è∞ TIME'S UP!</h1>
            <div class="gameover-icon">üòî</div>
            <p class="gameover-text">
                Oh no! You ran out of time!<br><br>
                The Johnson family is still missing...<br>
                But don't give up! A good detective never stops trying!
            </p>
            <button class="retry-btn" onclick="location.reload()">Try Again</button>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            currentRoom: 1,
            hintsUsed: { 1: 0, 2: 0, 3: 0 },
            maxHints: 3,
            cluesCollected: [],
            timeLeft: 40 * 60, // 40 minutes in seconds
            timerInterval: null,
            roomCodes: {
                1: '4245', // From answers: blue(4 letters), 42(age), 45(Tom's age - wait, let me fix this)
                2: '1612',
                3: '2024'
            },
            room1Correct: [false, false, false, false, false, false],
            room2Correct: [false, false, false, false, false, false, false, false],
            room3Correct: Array(20).fill(false),
            objectsExamined: [],
            currentClue: null
        };

        // Object Data
        const objectsData = {
            familyPhoto: {
                image: 'https://images.unsplash.com/photo-1609220136736-443140cffec6?w=600',
                title: 'üñºÔ∏è Family Photo',
                text: 'This is a beautiful family photo. You can see four people: a tall man with blond hair and blue eyes, a short woman with black hair, a teenage boy with brown hair and green eyes, and a young girl with blond hair and blue eyes. They all look happy. The frame says "The Johnson Family".',
                clue: 'The Johnson family has got four members: Tom (father), Mary (mother), Leo (son), and Emma (daughter).'
            },
            letter: {
                image: 'https://images.unsplash.com/photo-1586339949916-3e9457bef6d3?w=600',
                title: '‚úâÔ∏è Old Letter',
                text: 'Dear Tom,\n\nHappy Birthday! You are 45 years old now. I remember when we first met in London. Now we live together with our beautiful children.\n\nWith love,\nMary\n\nP.S. Your favourite colour is still blue, isn\'t it?',
                clue: 'Tom is 45 years old. He is from London. His favourite colour is blue.'
            },
            calendar: {
                image: 'https://images.unsplash.com/photo-1506784983877-45594efa4cbe?w=600',
                title: 'üìÖ Calendar',
                text: 'The calendar shows important dates:\n\n‚Ä¢ Tom\'s Birthday - He is 45!\n‚Ä¢ Mary\'s Birthday - She is 42!\n‚Ä¢ Leo\'s School Day - He is 16 years old\n‚Ä¢ Emma\'s Dance Class - She is 12 years old\n\nThere is a note: "Mary is from Paris. We must visit France soon!"',
                clue: 'Mary is 42 years old. She is from Paris. Leo is 16. Emma is 12.'
            },
            newspaper: {
                image: 'https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=600',
                title: 'üì∞ Local Newspaper',
                text: 'JOHNSON FAMILY WINS "BEST FAMILY" AWARD\n\nThe Johnson family - Tom, Mary, Leo, and Emma - are very popular in our town. Tom, the father, is a friendly man from London. He is tall and has got blue eyes. Mary, the mother, is from Paris. She is short and slim. They have got two children who are students.',
                clue: 'Tom is the father. He is tall and has got blue eyes and blond hair. Mary is the mother. She is from Paris.'
            },
            diary: {
                image: 'https://images.unsplash.com/photo-1518893063132-36e46dbe2428?w=600',
                title: 'üìî Leo\'s Diary',
                text: 'Dear Diary,\n\nToday I learned about my family for a school project!\n\nMy name is Leo. I am 16 years old. I have got green eyes and brown hair. I have got a big nose but a small mouth.\n\nMy favourite animal is a turtle. I have got a pet turtle named Shelly! My favourite colour is green - like my eyes!\n\nMy sister Emma is 12. Her favourite colour is pink. She loves horses!',
                clue: 'Leo is 16 years old. His favourite animal is a turtle. His favourite colour is green. He has got green eyes and brown hair.'
            },
            petPhoto: {
                image: 'https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=600',
                title: 'üêæ Pet Photos',
                text: 'There are photos of family pets:\n\n‚Ä¢ A dog - "This is Dad\'s dog. Tom loves dogs!"\n‚Ä¢ A cat - "This is Mum\'s cat. Mary\'s favourite animal is a cat."\n‚Ä¢ A turtle - "This is Shelly. Leo\'s favourite animal is a turtle."\n‚Ä¢ A horse poster - "Emma loves horses. Her favourite animal is a horse!"',
                clue: 'Tom\'s favourite animal is a dog. Mary\'s favourite animal is a cat. Leo\'s favourite animal is a turtle. Emma loves horses.'
            },
            notebook: {
                image: 'https://images.unsplash.com/photo-1531346878377-a5be20888e57?w=600',
                title: 'üìì School Notebook',
                text: 'ENGLISH CLASS - My Family\n\nBy Leo Johnson\n\nMy father\'s name is Tom. He is tall. He has got blue eyes and blond hair.\n\nMy mother\'s name is Mary. She is short and slim. She has got black hair and brown eyes. Her favourite colour is red.\n\nMy sister is Emma. She is 12 years old. She is short and slim too. She has got blond hair and blue eyes. She has got a small nose and big eyes.',
                clue: 'Emma is Tom\'s daughter. She is 12 years old. She has got blond hair, blue eyes, a small nose, and big eyes. Mary\'s favourite colour is red.'
            },
            poster: {
                image: 'https://images.unsplash.com/photo-1533227268428-f9ed0900fb3b?w=600',
                title: 'üñºÔ∏è Room Posters',
                text: 'In Leo\'s room:\n‚Ä¢ Green turtle poster - "Leo\'s room - he loves green!"\n‚Ä¢ His eyes are green like the poster!\n\nIn Emma\'s room:\n‚Ä¢ Pink horse poster - "Emma\'s favourite colour is pink!"\n‚Ä¢ She has got big blue eyes like the ocean.',
                clue: 'Leo has got green eyes. Emma\'s favourite colour is pink. Emma has got big eyes.'
            }
        };

        // Character Data
        const charactersData = {
            tom: {
                image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=600',
                name: 'Tom Johnson - Father',
                text: '<p><strong>Name:</strong> Tom Johnson</p><p><strong>Age:</strong> He is 45 years old.</p><p><strong>From:</strong> He is from London, England.</p><p><strong>Appearance:</strong> He is tall. He has got blue eyes and blond hair.</p><p><strong>Favourite colour:</strong> His favourite colour is blue.</p><p><strong>Favourite animal:</strong> His favourite animal is a dog.</p><p><strong>Family:</strong> He is Mary\'s husband. He is Leo and Emma\'s father.</p>'
            },
            mary: {
                image: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=600',
                name: 'Mary Johnson - Mother',
                text: '<p><strong>Name:</strong> Mary Johnson</p><p><strong>Age:</strong> She is 42 years old.</p><p><strong>From:</strong> She is from Paris, France.</p><p><strong>Appearance:</strong> She is short and slim. She has got black hair and brown eyes.</p><p><strong>Favourite colour:</strong> Her favourite colour is red.</p><p><strong>Favourite animal:</strong> Her favourite animal is a cat.</p><p><strong>Family:</strong> She is Tom\'s wife. She is Leo and Emma\'s mother.</p>'
            },
            leo: {
                image: 'https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?w=600',
                name: 'Leo Johnson - Son',
                text: '<p><strong>Name:</strong> Leo Johnson</p><p><strong>Age:</strong> He is 16 years old.</p><p><strong>Occupation:</strong> He is a student.</p><p><strong>Appearance:</strong> He is tall. He has got green eyes and brown hair. He has got a big nose and a small mouth.</p><p><strong>Favourite colour:</strong> His favourite colour is green.</p><p><strong>Favourite animal:</strong> His favourite animal is a turtle.</p><p><strong>Family:</strong> He is Tom and Mary\'s son. He is Emma\'s brother.</p>'
            },
            emma: {
                image: 'https://images.unsplash.com/photo-1595702419689-6b626dc83c33?w=600',
                name: 'Emma Johnson - Daughter',
                text: '<p><strong>Name:</strong> Emma Johnson</p><p><strong>Age:</strong> She is 12 years old.</p><p><strong>Appearance:</strong> She is short and slim. She has got blond hair and blue eyes. She has got a small nose and big eyes.</p><p><strong>Favourite colour:</strong> Her favourite colour is pink.</p><p><strong>Favourite animal:</strong> She loves horses.</p><p><strong>Family:</strong> She is Tom and Mary\'s daughter. She is Leo\'s sister.</p>'
            }
        };

        // Room 1 Answers
        const room1Answers = {
            1: ['his favourite colour is blue', 'his favorite color is blue', "tom's favourite colour is blue", "tom's favorite color is blue"],
            2: ['she is 42 years old', 'she is 42', 'she is forty-two years old', 'she is forty-two', 'she is forty two years old', 'she is forty two'],
            3: ['she is from paris', 'mary is from paris'],
            4: ['the father\'s name is tom', "the fathers name is tom", 'his name is tom', "tom", "his name is tom johnson", "the father's name is tom johnson"],
            5: ['yes, he has got blue eyes', 'yes he has got blue eyes', 'yes, he has', 'yes he has'],
            6: ['yes, they have got two children', 'yes they have got two children', 'yes, they have got children', 'yes they have got children', 'yes, they have', 'yes they have']
        };

        // Room 2 Answers
        const room2Answers = {
            1: ['his favourite animal is a turtle', 'his favorite animal is a turtle', "leo's favourite animal is a turtle", "leo's favorite animal is a turtle", 'his favourite animal is the turtle', 'his favorite animal is the turtle'],
            2: ['she is 12 years old', 'she is 12', 'she is twelve years old', 'she is twelve'],
            3: ['her favourite colour is red', 'her favorite color is red', "mary's favourite colour is red", "mary's favorite color is red"],
            4: ['tom\'s daughter is emma', "toms daughter is emma", 'his daughter is emma', 'emma', 'emma is tom\'s daughter', "emma is toms daughter", "emma johnson"],
            5: ['yes, he has got brown hair', 'yes he has got brown hair', 'yes, he has', 'yes he has'],
            6: ['she is short', 'emma is short'],
            7: ['he has got green eyes', 'leo has got green eyes'],
            8: ['she has got a small nose', 'emma has got a small nose']
        };

        // Room 3 Answers
        const room3Answers = {
            1: 'is',
            2: 'is',
            3: 'are',
            4: 'am',
            5: 'is',
            6: 'is',
            7: 'has got',
            8: 'has got',
            9: 'are',
            10: 'have got',
            11: 'is',
            '11b': 'not',
            12: 'is',
            '12b': 'not',
            13: "hasn't got",
            14: 'are',
            '14b': 'not',
            15: "hasn't got",
            16: 'is',
            17: 'are',
            18: 'has',
            '18b': 'got',
            19: 'have',
            '19b': 'got',
            20: 'are'
        };

        // Hints Data
        const hintsData = {
            1: [
                'üí° Hint 1: Read the letter on the table carefully. It talks about Tom\'s favourite colour!',
                'üí° Hint 2: Look at the calendar. It shows everyone\'s ages. Mary is the mother.',
                'üí° Hint 3: Remember to write COMPLETE sentences! Example: "His favourite colour is..."'
            ],
            2: [
                'üí° Hint 1: Read Leo\'s diary. He writes about his favourite animal.',
                'üí° Hint 2: Check the school notebook. It describes Emma\'s appearance and age.',
                'üí° Hint 3: Look at the pet photos. They show each family member\'s favourite animal.'
            ],
            3: [
                'üí° Hint 1: Use "is" for he, she, it. Use "are" for they, we, you. Use "am" for I.',
                'üí° Hint 2: Use "has got" for he, she, it. Use "have got" for I, you, we, they.',
                'üí° Hint 3: For negatives: "is not" or "isn\'t", "has not got" or "hasn\'t got".'
            ]
        };

        // Start Game
        function startGame() {
            document.getElementById('introScreen').classList.add('hidden');
            document.getElementById('topBar').style.display = 'flex';
            document.getElementById('gameContainer').classList.add('active');
            document.getElementById('narrationBox').style.display = 'block';
            
            // Start timer
            gameState.timerInterval = setInterval(updateTimer, 1000);
            
            // Show initial narration
            showNarration("Detective Sam", "I'm inside the Johnson house. The living room is dark and quiet. I need to find clues about this family. Who are they? Where are they from? I'll examine everything carefully!", "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100");
        }

        // Timer
        function updateTimer() {
            gameState.timeLeft--;
            
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (gameState.timeLeft <= 300) {
                timerElement.classList.add('warning');
            }
            
            if (gameState.timeLeft <= 0) {
                clearInterval(gameState.timerInterval);
                gameOver();
            }
        }

        // Show Narration
        function showNarration(name, message, avatar) {
            document.getElementById('narratorName').textContent = name;
            document.getElementById('narrationMessage').textContent = message;
            document.getElementById('narratorAvatar').src = avatar;
            document.getElementById('narrationBox').style.display = 'block';
        }

        // Examine Object
        function examineObject(objectId) {
            const data = objectsData[objectId];
            if (!data) return;
            
            document.getElementById('modalImage').src = data.image;
            document.getElementById('modalTitle').textContent = data.title;
            document.getElementById('modalText').innerHTML = data.text.replace(/\n/g, '<br>');
            
            // Show clue card if not already collected
            if (data.clue && !gameState.cluesCollected.includes(objectId)) {
                document.getElementById('clueCard').style.display = 'block';
                document.getElementById('clueText').textContent = data.clue;
                document.getElementById('collectBtn').disabled = false;
                gameState.currentClue = { id: objectId, text: data.clue };
            } else {
                document.getElementById('clueCard').style.display = 'none';
            }
            
            // Mark as examined
            if (!gameState.objectsExamined.includes(objectId)) {
                gameState.objectsExamined.push(objectId);
                event.target.closest('.clickable-object').classList.add('examined');
            }
            
            document.getElementById('objectModal').classList.add('active');
        }

        // Close Modal
        function closeModal() {
            document.getElementById('objectModal').classList.remove('active');
        }

        // Show Character
        function showCharacter(charId) {
            const data = charactersData[charId];
            if (!data) return;
            
            document.getElementById('charModalImage').src = data.image;
            document.getElementById('charModalName').textContent = data.name;
            document.getElementById('charModalText').innerHTML = data.text;
            
            document.getElementById('characterModal').classList.add('active');
        }

        // Close Character Modal
        function closeCharacterModal() {
            document.getElementById('characterModal').classList.remove('active');
        }

        // Collect Clue
        function collectClue() {
            if (gameState.currentClue) {
                gameState.cluesCollected.push(gameState.currentClue.id);
                
                // Update inventory
                const inventoryItems = document.getElementById('inventoryItems');
                if (gameState.cluesCollected.length === 1) {
                    inventoryItems.innerHTML = '';
                }
                
                const clueDiv = document.createElement('div');
                clueDiv.className = 'inventory-item';
                clueDiv.innerHTML = `<strong>üìã Clue ${gameState.cluesCollected.length}:</strong><br>${gameState.currentClue.text}`;
                inventoryItems.appendChild(clueDiv);
                
                // Update clue count
                document.getElementById('clueCount').textContent = gameState.cluesCollected.length;
                
                // Disable button
                document.getElementById('collectBtn').disabled = true;
                document.getElementById('collectBtn').textContent = '‚úì Added!';
                
                gameState.currentClue = null;
            }
        }

        // Toggle Inventory
        function toggleInventory() {
            document.getElementById('inventoryPanel').classList.toggle('active');
        }

        // Use Hint
        function useHint() {
            const room = gameState.currentRoom;
            const hintsUsed = gameState.hintsUsed[room];
            
            if (hintsUsed >= gameState.maxHints) {
                alert('No more hints available for this room!');
                return;
            }
            
            gameState.hintsUsed[room]++;
            document.getElementById('hintsLeft').textContent = gameState.maxHints - gameState.hintsUsed[room];
            
            const hintDisplay = document.getElementById(`room${room}Hint`);
            hintDisplay.innerHTML = hintsData[room][hintsUsed];
            hintDisplay.classList.add('show');
        }

        // Normalize answer for comparison
        function normalizeAnswer(answer) {
            return answer.toLowerCase().trim().replace(/[.,!?]/g, '').replace(/\s+/g, ' ');
        }

        // Check Room 1 Answers
        function checkRoom1Answers() {
            let correctCount = 0;
            const code = ['4', '2', '4', '5']; // blue(4), 42, from(4), 5 letters in Tom... Let me use: B-L-U-E related
            
            for (let i = 1; i <= 6; i++) {
                const answer = normalizeAnswer(document.getElementById(`answer1_${i}`).value);
                const questionItem = document.getElementById(`q1_${i}`);
                const feedback = document.getElementById(`feedback1_${i}`);
                const correctAnswers = room1Answers[i];
                
                if (correctAnswers.some(ca => normalizeAnswer(ca) === answer || answer.includes(normalizeAnswer(ca)))) {
                    questionItem.classList.remove('incorrect');
                    questionItem.classList.add('correct');
                    feedback.textContent = '‚úì Correct! Great job!';
                    feedback.className = 'feedback show success';
                    document.getElementById(`answer1_${i}`).disabled = true;
                    gameState.room1Correct[i-1] = true;
                    correctCount++;
                } else if (answer.length > 0) {
                    questionItem.classList.remove('correct');
                    questionItem.classList.add('incorrect');
                    feedback.textContent = '‚úó Not quite right. Remember to write a complete sentence!';
                    feedback.className = 'feedback show error';
                    questionItem.classList.add('shake');
                    setTimeout(() => questionItem.classList.remove('shake'), 500);
                }
            }
            
            // Update code digits based on first 4 correct answers
            for (let i = 0; i < 4; i++) {
                if (gameState.room1Correct[i]) {
                    const digit = document.getElementById(`digit1_${i + 1}`);
                    digit.textContent = code[i];
                    digit.classList.add('filled');
                }
            }
            
            // Check if first 4 are correct to unlock
            if (gameState.room1Correct.slice(0, 4).every(c => c)) {
                document.getElementById('unlockBtn1').disabled = false;
                showNarration("Detective Sam", "Excellent! I found the code: " + code.join('') + "! The door to the bedrooms should open now.", "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100");
            }
        }

        // Check Room 2 Answers
        function checkRoom2Answers() {
            let correctCount = 0;
            const code = ['1', '6', '1', '2']; // turtle, 12, red, emma
            
            for (let i = 1; i <= 8; i++) {
                const answer = normalizeAnswer(document.getElementById(`answer2_${i}`).value);
                const questionItem = document.getElementById(`q2_${i}`);
                const feedback = document.getElementById(`feedback2_${i}`);
                const correctAnswers = room2Answers[i];
                
                if (correctAnswers.some(ca => normalizeAnswer(ca) === answer || answer.includes(normalizeAnswer(ca)))) {
                    questionItem.classList.remove('incorrect');
                    questionItem.classList.add('correct');
                    feedback.textContent = '‚úì Correct! Well done!';
                    feedback.className = 'feedback show success';
                    document.getElementById(`answer2_${i}`).disabled = true;
                    gameState.room2Correct[i-1] = true;
                    correctCount++;
                } else if (answer.length > 0) {
                    questionItem.classList.remove('correct');
                    questionItem.classList.add('incorrect');
                    feedback.textContent = '‚úó Try again. Check the clues carefully!';
                    feedback.className = 'feedback show error';
                    questionItem.classList.add('shake');
                    setTimeout(() => questionItem.classList.remove('shake'), 500);
                }
            }
            
            // Update code digits
            for (let i = 0; i < 4; i++) {
                if (gameState.room2Correct[i]) {
                    const digit = document.getElementById(`digit2_${i + 1}`);
                    digit.textContent = code[i];
                    digit.classList.add('filled');
                }
            }
            
            // Check if first 4 are correct to unlock
            if (gameState.room2Correct.slice(0, 4).every(c => c)) {
                document.getElementById('unlockBtn2').disabled = false;
                showNarration("Detective Sam", "The code is " + code.join('') + "! There must be a secret room somewhere...", "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100");
            }
        }

        // Check Room 3 Answers
        function checkRoom3Answers() {
            let correctCount = 0;
            const totalQuestions = 20;
            const code = ['2', '0', '2', '4'];
            
            // Check single blanks
            for (let i = 1; i <= 20; i++) {
                const input = document.getElementById(`blank${i}`);
                if (!input) continue;
                
                const answer = normalizeAnswer(input.value);
                const correctAnswer = normalizeAnswer(room3Answers[i] || '');
                const fillItem = document.getElementById(`fb${i}`);
                
                if (answer === correctAnswer) {
                    input.classList.remove('incorrect');
                    input.classList.add('correct');
                    input.disabled = true;
                    gameState.room3Correct[i-1] = true;
                    correctCount++;
                    if (fillItem) fillItem.classList.add('correct');
                } else if (answer.length > 0) {
                    input.classList.remove('correct');
                    input.classList.add('incorrect');
                }
            }
            
            // Check double blanks
            const doubleBlanks = ['11b', '12b', '14b', '18b', '19b'];
            doubleBlanks.forEach(id => {
                const input = document.getElementById(`blank${id}`);
                if (!input) return;
                
                const answer = normalizeAnswer(input.value);
                const correctAnswer = normalizeAnswer(room3Answers[id] || '');
                
                if (answer === correctAnswer) {
                    input.classList.remove('incorrect');
                    input.classList.add('correct');
                    input.disabled = true;
                } else if (answer.length > 0) {
                    input.classList.remove('correct');
                    input.classList.add('incorrect');
                }
            });
            
            // Count all correct
            let allCorrect = 0;
            for (let i = 1; i <= 20; i++) {
                const input = document.getElementById(`blank${i}`);
                if (input && input.classList.contains('correct')) {
                    allCorrect++;
                }
            }
            doubleBlanks.forEach(id => {
                const input = document.getElementById(`blank${id}`);
                if (input && input.classList.contains('correct')) {
                    allCorrect++;
                }
            });
            
            // Update code digits based on progress
            const requiredCorrect = [6, 12, 18, 25];
            for (let i = 0; i < 4; i++) {
                if (allCorrect >= requiredCorrect[i]) {
                    const digit = document.getElementById(`digit3_${i + 1}`);
                    digit.textContent = code[i];
                    digit.classList.add('filled');
                }
            }
            
            // Check if all are correct
            if (allCorrect >= 25) {
                document.getElementById('unlockBtn3').disabled = false;
                showNarration("Detective Sam", "I've got it! The final code is " + code.join('') + "! Now I can find the Johnson family!", "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100");
            }
        }

        // Unlock Room
        function unlockRoom(roomNumber) {
            // Show transition
            document.getElementById('transitionScreen').classList.add('active');
            document.getElementById('transitionText').textContent = `Opening the door to Room ${roomNumber}...`;
            
            setTimeout(() => {
                document.getElementById('transitionScreen').classList.remove('active');
                
                // Hide current room
                document.getElementById(`room${roomNumber - 1}`).classList.remove('active');
                
                // Show new room
                document.getElementById(`room${roomNumber}`).classList.add('active');
                
                // Update progress
                document.getElementById(`step${roomNumber - 1}`).classList.remove('active');
                document.getElementById(`step${roomNumber - 1}`).classList.add('completed');
                document.getElementById(`step${roomNumber}`).classList.add('active');
                
                // Update room name
                gameState.currentRoom = roomNumber;
                const roomNames = {
                    2: 'üõèÔ∏è Room 2 - The Bedrooms',
                    3: 'üîê Room 3 - The Secret Room'
                };
                document.getElementById('roomTitle').textContent = roomNames[roomNumber];
                
                // Reset hints for new room
                document.getElementById('hintsLeft').textContent = gameState.maxHints - gameState.hintsUsed[roomNumber];
                
                // Show narration
                const narrations = {
                    2: "I'm in the bedrooms now. I can see personal items everywhere. The children's rooms might have important clues about Leo and Emma!",
                    3: "A secret room! This is where the mystery ends. I need to prove I know everything about the Johnson family to find them!"
                };
                showNarration("Detective Sam", narrations[roomNumber], "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100");
                
                // Scroll to top
                window.scrollTo(0, 0);
                
            }, 2000);
        }

        // Win Game
        function winGame() {
            clearInterval(gameState.timerInterval);
            
            const timeSpent = (40 * 60) - gameState.timeLeft;
            const minutes = Math.floor(timeSpent / 60);
            const seconds = timeSpent % 60;
            
            document.getElementById('finalTime').textContent = `‚è±Ô∏è Time: ${minutes} minutes and ${seconds} seconds`;
            
            // Show transition
            document.getElementById('transitionScreen').classList.add('active');
            document.getElementById('transitionText').textContent = "Finding the Johnson family...";
            document.getElementById('transitionScreen').querySelector('.transition-icon').textContent = 'üîç';
            
            setTimeout(() => {
                document.getElementById('transitionScreen').classList.remove('active');
                document.getElementById('victoryScreen').classList.add('active');
            }, 3000);
        }

        // Game Over
        function gameOver() {
            document.getElementById('gameoverScreen').classList.add('active');
        }

        // Close modals on click outside
        document.getElementById('objectModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        document.getElementById('characterModal').addEventListener('click', function(e) {
            if (e.target === this) closeCharacterModal();
        });

        // Close narration on click
        document.getElementById('narrationBox').addEventListener('click', function() {
            this.style.display = 'none';
        });

        // Keyboard support
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                closeCharacterModal();
            }
        });
    </script>
</body>
</html>
